<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Biology EOC Achievement Analysis - Druid Hills High School</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&amp;display=swap" rel="stylesheet"/>
<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            /* UPDATED: Using Poppins font */
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .dashboard {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
            font-weight: 300;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card.trend-up {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }
        
        .stat-card.trend-down {
            background: linear-gradient(135deg, #FF7043, #F4511E);
        }
        
        .stat-card.warning {
            background: linear-gradient(135deg, #FF9800, #F57C00);
        }

        /* NEW: Style for stat card icons */
        .stat-icon {
            width: 32px;
            height: 32px;
            margin-bottom: 15px;
            opacity: 0.8;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            line-height: 1;
        }
        
        .stat-label {
            font-size: 1.1em;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .stat-trend {
            font-size: 0.9em;
            margin-top: 10px;
            opacity: 0.8;
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            border: 1px solid #e8ecef;
        }
        
        .chart-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
        }
        
        .full-width-chart {
            grid-column: 1 / -1;
        }
        
        .achievement-gaps {
            background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
        }
        
        .gaps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .gap-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        .gap-card h3 {
            font-size: 1.2em;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .gap-stat {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .gap-description {
            font-size: 0.95em;
            opacity: 0.9;
            line-height: 1.4;
        }
        
        .insights {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
        }
        
        .insights h3 {
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .insights ul {
            list-style: none;
        }
        
        .insights li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }
        
        .insights li:before {
            content: 'ðŸ§¬';
            position: absolute;
            left: 0;
        }
        
        @media (max-width: 768px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
<div class="dashboard">
<div class="header">
<h1>Biology EOC Achievement Analysis</h1>
<p class="subtitle">Five-Year Longitudinal Study: Pre-Pandemic to Present (2019-2024)</p>
</div>
<div class="stats-grid">
<div class="stat-card trend-down">
<svg class="stat-icon" fill="white" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 9v12H4V9l8-6 8 6zM6 19h12v-8.485l-6-4.5-6 4.5V19z"></path></svg>
<div class="stat-number">38.4%</div>
<div class="stat-label">2019 Baseline</div>
<div class="stat-trend">Pre-pandemic performance</div>
</div>
<div class="stat-card warning">
<svg class="stat-icon" fill="white" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 18H3a1 1 0 0 1 0-2h18a1 1 0 0 1 0 2zm-5-8.83V4a1 1 0 0 0-2 0v5.17a3.001 3.001 0 0 0-5 0V4a1 1 0 1 0-2 0v5.17a3.001 3.001 0 0 0-5 0v.66a1 1 0 0 0 1.555.832L8 9.17V14a1 1 0 1 0 2 0V9.17l1.445 1.156a1 1 0 0 0 1.11 0L14 9.17V14a1 1 0 0 0 2 0V9.17l1.445 1.156A1 1 0 0 0 19 9.83v-.66a3.001 3.001 0 0 0-3-2.97z"></path></svg>
<div class="stat-number">55.6pts</div>
<div class="stat-label">Widening Gap</div>
<div class="stat-trend">White-Black Achievement</div>
</div>
<div class="stat-card trend-down">
<svg class="stat-icon" fill="white" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"></path></svg>
<div class="stat-number">7.7%</div>
<div class="stat-label">EL Crisis (2019)</div>
<div class="stat-trend">Persistent 5-year crisis</div>
</div>
<div class="stat-card">
<svg class="stat-icon" fill="white" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 1L9 9h6l-3-8zM3 21h18v-2H3v2zm9-2l3-8H6l3 8zM2 17h20v-2H2v2z"></path></svg>
<div class="stat-number">75.2%</div>
<div class="stat-label">White Students (2019)</div>
<div class="stat-trend">Consistent outlier performance</div>
</div>
<div class="stat-card warning">
<svg class="stat-icon" fill="white" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6h-6z"></path></svg>
<div class="stat-number">+7.8pts</div>
<div class="stat-label">Gap Growth</div>
<div class="stat-trend">Achievement gap worsened</div>
</div>
<div class="stat-card trend-up">
<svg class="stat-icon" fill="white" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 10.5L8 3l5.5 8.5H11v8h2v-8h2.5L21.5 10.5h-5l-4-6.5-4 6.5h-5z"></path></svg>
<div class="stat-number">65.0%</div>
<div class="stat-label">2023 Peak</div>
<div class="stat-trend">Best overall performance</div>
</div>
</div>
<div class="charts-container">
<div class="chart-card">
<h3 class="chart-title">Five-Year Achievement Trends by Ethnicity<br/><span style="font-size: 0.8em; color: #666;">(2020â€“2024: Post-Pandemic to Present) â€¢ N = 478 Biology EOC test-takers (Grades 9â€“10)</span></h3>
<div class="chart-container">
<canvas id="ethnicityTrendsChart"></canvas>
</div>
</div>
<div class="chart-card">
<h3 class="chart-title">2024 Performance by Subgroup<br/><span style="font-size: 0.8em; color: #666;">(Level 3 + Level 4 Proficient) â€¢ N = 171 Biology EOC test-takers (Grades 9â€“10)</span></h3>
<div class="chart-container">
<canvas id="subgroupPerformanceChart"></canvas>
</div>
</div>
<div class="chart-card full-width-chart">
<h3 class="chart-title">The "High-Performing School" Illusion: Overall vs. Disaggregated Performance<br/><span style="font-size: 0.8em; color: #666;">(2021â€“2024 Trend Analysis) â€¢ N â‰ˆ 661 Biology EOC test-takers (Grades 9â€“10)</span></h3>
<div class="chart-container">
<canvas id="illusionChart"></canvas>
</div>
</div>
<div class="chart-card full-width-chart">
<h3 class="chart-title">CCRPI Score Trends: The Persistence of Inequality<br/><span style="font-size: 0.8em; color: #666;">(2021â€“2024) â€¢ N â‰ˆ 661 Biology EOC test-takers (Grades 9â€“10)</span></h3>
<div class="chart-container">
<canvas id="ccrpiTrendsChart"></canvas>
</div>
</div>
</div>
<div class="achievement-gaps">
<h3>ðŸš¨ Critical Finding: "High-Performing School" Status Masks Systematic Equity Crisis</h3>
<div class="gaps-grid">
<div class="gap-card">
<h3>ðŸ“ˆ Widening Racial Gap</h3>
<div class="gap-stat">+7.8 points</div>
<div class="gap-description">White-Black achievement gap WORSENED from 47.8 points (2019) to 55.6 points (2024), proving persistent institutional inequity.</div>
</div>
<div class="gap-card">
<h3>ðŸŽ­ Performance Illusion</h3>
<div class="gap-stat">75.2% vs 27.4%</div>
<div class="gap-description">2019 data proves White students (75.2%) consistently function as outliers, masking majority student underperformance.</div>
</div>
<div class="gap-card">
<h3>ðŸ“š 5-Year EL Crisis</h3>
<div class="gap-stat">7.7% â†’ 11.1%</div>
<div class="gap-description">English Learners remain in academic crisis across 5 years, with minimal improvement despite interventions.</div>
</div>
<div class="gap-card">
<h3>â™¿ Disability Decline</h3>
<div class="gap-stat">11.9% â†’ 14.9%</div>
<div class="gap-description">Students with Disabilities show minimal 5-year gains, then dramatic 2024 decline suggests systemic support failures.</div>
</div>
</div>
</div>
<div class="insights">
<h3>Critical Findings: Five-Year Longitudinal Analysis</h3>
<ul>
<li><strong>Pre-Pandemic Crisis:</strong> 2019 baseline (38.4% proficient) proves achievement gaps existed before COVID, indicating systemic institutional issues.</li>
<li><strong>Outlier Effect Documented:</strong> White students consistently perform 45-55 points higher, artificially inflating "school performance" metrics.</li>
<li><strong>Persistent EL Emergency:</strong> English Learners trapped in crisis (7.7% to 11.1%) across five years with no meaningful improvement.</li>
<li><strong>Worsening Equity:</strong> White-Black achievement gap widened 7.8 points over 5 years despite school improvement efforts.</li>
<li><strong>"High-Performing" Myth:</strong> Disaggregated data reveals majority of students underperform while aggregate metrics suggest success.</li>
<li><strong>Intervention Failure:</strong> Five-year trends prove current strategies inadequate for closing persistent achievement gaps.</li>
</ul>
</div>
<section id="achievement-comparison">
<h3 class="chart-title">Biology EOC Achievement Level Distribution (2021â€“2024)</h3>
<div style="margin-bottom: 10px;">
<label><input checked="" id="toggleState" type="checkbox"/> Show State</label>
<label><input checked="" id="toggleCounty" type="checkbox"/> Show County</label>
<label><input checked="" id="toggleSchool" type="checkbox"/> Show School</label>
<button id="resetButton" style="margin-left: 20px; font-size: 14px;">ðŸ”„ Reset Chart</button></div>
<canvas height="600" id="comparisonChart" width="1200"></canvas>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
<script>
const ctx = document.getElementById('comparisonChart').getContext('2d');

const labels = [
    "2021 - State", "2021 - County", "2021 - School",
    "2022 - State", "2022 - County", "2022 - School",
    "2023 - State", "2023 - County", "2023 - School",
    "2024 - State", "2024 - County", "2024 - School"
];

const nCounts = [
    31843, 2417, 183,
    35451, 2793, 125,
    35300, 2638, 182,
    35256, 2638, 171
];

const datasets = [
    {
        label: "Beginning",
        backgroundColor: "#f8c7b0",
        data: [33, 47, 30, 35, 49, 18, 34, 44, 27, 35, 44, 23],
        group: ["State", "County", "School","State", "County", "School","State", "County", "School","State", "County", "School"],
        stack: "combined"
    },
    {
        label: "Developing",
        backgroundColor: "#f9ecb2",
        data: [26, 24, 20, 25, 24, 14, 27, 26, 27, 27, 26, 22],
        group: ["State", "County", "School","State", "County", "School","State", "County", "School","State", "County", "School"],
        stack: "combined"
    },
    {
        label: "Proficient",
        backgroundColor: "#b8e7c5",
        data: [33, 23, 39, 31, 20, 41, 29, 24, 31, 30, 24, 43],
        group: ["State", "County", "School","State", "County", "School","State", "County", "School","State", "County", "School"],
        stack: "combined"
    },
    {
        label: "Distinguished",
        backgroundColor: "#c7d9f1",
        data: [9, 7, 11, 9, 7, 28, 10, 5, 14, 8, 5, 12],
        group: ["State", "County", "School","State", "County", "School","State", "County", "School","State", "County", "School"],
        stack: "combined"
    }
];

const config = {
    type: 'bar',
    data: {
        labels: labels,
        datasets: datasets
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'top'
            },
            tooltip: {
                mode: 'index',
                intersect: false
            },
            datalabels: {
                color: '#000',
                anchor: 'center',
                align: 'center',
                formatter: value => value + '%',
                font: {
                    weight: 'bold',
                    size: 10
                }
            }
        },
        interaction: {
            mode: 'nearest',
            axis: 'x',
            intersect: false
        },
        scales: {
            x: {
                stacked: true,
                title: {
                    display: true,
                    text: 'Year and Group'
                }
            },
            y: {
                stacked: true,
                max: 110,
                title: {
                    display: true,
                    text: 'Percentage of Students'
                }
            }
        }
    },
    plugins: [ChartDataLabels, {
        id: 'nLabelPlugin',
        afterDatasetsDraw(chart) {
            const {ctx} = chart;
            const count = chart.data.labels.length;
            const meta = chart.getDatasetMeta(chart.data.datasets.length - 1);
            for (let i = 0; i < count; i++) {
                const bar = meta.data[i];
                if (bar) {
                    ctx.save();
                    ctx.font = "italic 10px sans-serif";
                    ctx.fillStyle = "gray";
                    ctx.textAlign = "center";
                    ctx.fillText("N=" + nCounts[i], bar.x, bar.y - 8);
                    ctx.restore();
                }
            }
        }
    }]
};

const chart = new Chart(ctx, config);

function updateVisibility() {
    const showState = document.getElementById('toggleState').checked;
    const showCounty = document.getElementById('toggleCounty').checked;
    const showSchool = document.getElementById('toggleSchool').checked;

    chart.data.datasets.forEach((ds, idx) => {
        ds.data = ds.data.map((val, i) => {
            const label = ds.group[i];
            if (label === "State" && !showState) return null;
            if (label === "County" && !showCounty) return null;
            if (label === "School" && !showSchool) return null;
            return val;
        });
    });
    chart.update();
}

document.getElementById('toggleState').addEventListener('change', updateVisibility);
document.getElementById('toggleCounty').addEventListener('change', updateVisibility);
document.getElementById('toggleSchool').addEventListener('change', updateVisibility);
</script>
<script>
    const originalData = {
        "Beginning": [33, 47, 30, 35, 49, 18, 34, 44, 27, 35, 44, 23],
        "Developing": [26, 24, 20, 25, 24, 14, 27, 26, 27, 27, 26, 22],
        "Proficient": [33, 23, 39, 31, 20, 41, 29, 24, 31, 30, 24, 43],
        "Distinguished": [9, 7, 11, 9, 7, 28, 10, 5, 14, 8, 5, 12]
    };

    document.getElementById('resetButton').addEventListener('click', () => {
        document.getElementById('toggleState').checked = true;
        document.getElementById('toggleCounty').checked = true;
        document.getElementById('toggleSchool').checked = true;

        chart.data.datasets.forEach((ds) => {
            const group = ds.label;
            const band = group;
            const values = originalData[band];
            if (values) {
                ds.data = values.slice();
            }
        });

        chart.update();
    });
    </script></section></div>
<script>
        // --- DATA INITIALIZATION ---
        // Data is pre-calculated from source CSVs.
        // Proficiency Rate = Level 3 (%) + Level 4 (%).
        // CCRPI scores are taken directly from the source data.
        const biologyData = {
            2019: {
                'All Students': { proficiency: 38.4, ccrpi: 53.99 },
                'Asian / Pacific Islander': { proficiency: 21.5, ccrpi: 36.2 },
                'Black': { proficiency: 27.4, ccrpi: 40.64 },
                'Hispanic': { proficiency: 24.6, ccrpi: 36.69 },
                'White': { proficiency: 75.2, ccrpi: 97.01 },
                'Economically Disadvantaged': { proficiency: 17.5, ccrpi: 29.96 },
                'English Learners': { proficiency: 7.7, ccrpi: 19.71 },
                'Students with Disability': { proficiency: 11.9, ccrpi: 20.03 }
            },
            2022: {
                'All Students': { proficiency: 55.4, ccrpi: 72.46 },
                'Asian / Pacific Islander': { proficiency: 54.0, ccrpi: 68.92 },
                'Black': { proficiency: 33.8, ccrpi: 48.13 },
                'Hispanic': { proficiency: 48.1, ccrpi: 62.51 },
                'White': { proficiency: 82.5, ccrpi: 100 },
                'Economically Disadvantaged': { proficiency: 30.0, ccrpi: 43.5 },
                'English Learners': { proficiency: 23.9, ccrpi: 35.87 },
                'Students with Disability': { proficiency: 25.6, ccrpi: 42.31 }
            },
            2023: {
                'All Students': { proficiency: 65.0, ccrpi: 87.43 },
                'Asian / Pacific Islander': { proficiency: 60.9, ccrpi: 78.27 },
                'Black': { proficiency: 46.7, ccrpi: 66.2 },
                'Hispanic': { proficiency: 51.4, ccrpi: 74.32 },
                'White': { proficiency: 86.2, ccrpi: 100 },
                'Economically Disadvantaged': { proficiency: 48.6, ccrpi: 68.22 },
                'English Learners': { proficiency: 20.0, ccrpi: 35 },
                'Students with Disability': { proficiency: 43.6, ccrpi: 56.42 }
            },
            2024: {
                'All Students': { proficiency: 48.9, ccrpi: 70.57 },
                'Asian / Pacific Islander': { proficiency: 46.7, ccrpi: 66.67 },
                'Black': { proficiency: 28.7, ccrpi: 50.74 },
                'Hispanic': { proficiency: 31.8, ccrpi: 57.58 },
                'White': { proficiency: 84.3, ccrpi: 100 },
                'Economically Disadvantaged': { proficiency: 27.7, ccrpi: 50 },
                'English Learners': { proficiency: 11.1, ccrpi: 33.33 },
                'Students with Disability': { proficiency: 14.9, ccrpi: 29.8 }
            }
        };

        // --- CHART CONFIGURATION ---
        
        // Color palettes for chart consistency
        const ethnicityColors = {
            'Black': '#8E24AA',
            'White': '#1976D2', 
            'Hispanic': '#FF7043',
            'Asian / Pacific Islander': '#4CAF50'
        };
        const subgroupColors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FECA57', '#FF9FF3', '#54A0FF', '#5F27CD'];

        // --- CHART 1: Five-Year Ethnicity Trends ---
        const ethnicityTrendsCtx = document.getElementById('ethnicityTrendsChart').getContext('2d');
        new Chart(ethnicityTrendsCtx, {
            type: 'line',
            data: {
                labels: ['2019', '2022', '2023', '2024'],
                datasets: [
                    { label: 'Black', data: [27.4, 33.8, 46.7, 28.7], borderColor: ethnicityColors['Black'], backgroundColor: ethnicityColors['Black'] + '20', tension: 0.1, borderWidth: 3 },
                    { label: 'White', data: [75.2, 82.5, 86.2, 84.3], borderColor: ethnicityColors['White'], backgroundColor: ethnicityColors['White'] + '20', tension: 0.1, borderWidth: 3 },
                    { label: 'Hispanic', data: [24.6, 48.1, 51.4, 31.8], borderColor: ethnicityColors['Hispanic'], backgroundColor: ethnicityColors['Hispanic'] + '20', tension: 0.1, borderWidth: 3 },
                    { label: 'Asian/Pacific Islander', data: [21.5, 54.0, 60.9, 46.7], borderColor: ethnicityColors['Asian / Pacific Islander'], backgroundColor: ethnicityColors['Asian / Pacific Islander'] + '20', tension: 0.1, borderWidth: 3 }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                // UPDATED: Added explicit animation and hover interactivity
                animation: { duration: 1000, easing: 'easeInOutQuart' },
                onHover: (event, chartElement, chart) => {
                    chart.canvas.style.cursor = chartElement[0] ? 'pointer' : 'default';
                },
                scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: 'Proficiency Rate (%)' } } },
                plugins: {
                    legend: { position: 'top', 
                        // UPDATED: Dims other datasets on legend hover to focus attention
                        onHover: (e, legendItem, legend) => {
                            legend.chart.data.datasets.forEach(d => { d.borderColor = d.backgroundColor.replace('20', ''); d.borderWidth = 3; });
                            const hoveredDataset = legend.chart.data.datasets.find(d => d.label === legendItem.text);
                            legend.chart.data.datasets.forEach(d => { if(d.label !== hoveredDataset.label) { d.borderColor = '#e0e0e0'; d.borderWidth = 1.5; } });
                            legend.chart.update();
                        },
                        onLeave: (e, legendItem, legend) => {
                           legend.chart.data.datasets.forEach(d => { d.borderColor = d.backgroundColor.replace('20', ''); d.borderWidth = 3; });
                           legend.chart.update();
                        }
                    },
                    tooltip: { callbacks: { label: context => `${context.dataset.label}: ${context.parsed.y}% proficient` } }
                }
            }
        });

        // --- CHART 2: 2024 Subgroup Performance ---
        const subgroupCtx = document.getElementById('subgroupPerformanceChart').getContext('2d');
        const subgroups = Object.keys(biologyData[2024]);
        const proficiencyRates = subgroups.map(subgroup => biologyData[2024][subgroup].proficiency);

        new Chart(subgroupCtx, {
            type: 'bar',
            data: {
                labels: subgroups.map(s => s.replace(' / ', '/\n').replace('Students with Disability', 'SWD')),
                datasets: [{
                    label: 'Proficiency Rate (%)', data: proficiencyRates, backgroundColor: subgroupColors, borderRadius: 5 
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                animation: { duration: 1000, easing: 'easeInOutQuart' },
                scales: {
                    y: { beginAtZero: true, max: 100, title: { display: true, text: 'Proficiency Rate (%)' } },
                    x: { ticks: { maxRotation: 45, font: { size: 10 } } }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: { callbacks: { label: context => `${context.parsed.y}% proficient` } }
                }
            }
        });

        // --- CHART 3: High-Performing School Illusion ---
        const illusionCtx = document.getElementById('illusionChart').getContext('2d');
        new Chart(illusionCtx, {
            type: 'line',
            data: {
                labels: ['2019', '2022', '2023', '2024'],
                datasets: [
                    { label: 'All Students (Aggregate)', data: [38.4, 55.4, 65.0, 48.9], borderColor: '#FF6B6B', backgroundColor: '#FF6B6B20', tension: 0.1, borderWidth: 4, borderDash: [5, 5] },
                    { label: 'White Students (Outlier)', data: [75.2, 82.5, 86.2, 84.3], borderColor: '#1976D2', backgroundColor: '#1976D220', tension: 0.1, borderWidth: 4 },
                    { label: 'Black Students', data: [27.4, 33.8, 46.7, 28.7], borderColor: '#8E24AA', backgroundColor: '#8E24AA20', tension: 0.1, borderWidth: 3 },
                    { label: 'English Learners', data: [7.7, 23.9, 20.0, 11.1], borderColor: '#FF7043', backgroundColor: '#FF704320', tension: 0.1, borderWidth: 3 },
                    { label: 'Students with Disabilities', data: [11.9, 25.6, 43.6, 14.9], borderColor: '#4CAF50', backgroundColor: '#4CAF5020', tension: 0.1, borderWidth: 3 }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                animation: { duration: 1000, easing: 'easeInOutQuart' },
                scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: 'Proficiency Rate (%)' } } },
                plugins: {
                    legend: { position: 'top' }, // Interactive hover effect could be added here too if desired
                    tooltip: { callbacks: { label: context => `${context.dataset.label}: ${context.parsed.y}% proficient` } }
                }
            }
        });

        // --- CHART 4: CCRPI Score Trends ---
        const ccrpiCtx = document.getElementById('ccrpiTrendsChart').getContext('2d');
        new Chart(ccrpiCtx, {
            type: 'line',
            data: {
                labels: ['2019', '2022', '2023', '2024'],
                datasets: subgroups.map((subgroup, index) => ({
                    label: subgroup.replace('Students with Disability', 'SWD'),
                    data: [2019, 2022, 2023, 2024].map(year => biologyData[year][subgroup].ccrpi),
                    borderColor: subgroupColors[index],
                    backgroundColor: subgroupColors[index] + '20',
                    tension: 0.1,
                    borderWidth: 2
                }))
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                animation: { duration: 1000, easing: 'easeInOutQuart' },
                scales: { y: { beginAtZero: true, max: 110, title: { display: true, text: 'CCRPI Score' } } },
                plugins: {
                    legend: { position: 'top', labels: { font: { size: 10 } } },
                    tooltip: { callbacks: { label: context => `${context.dataset.label}: ${context.parsed.y} CCRPI` } }
                }
            }
        });
    </script>
</body>
</html>
